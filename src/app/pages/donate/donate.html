<div class="full-width-container dark-theme">
    <div class="donation-hero"
        [style.background-image]="'linear-gradient(rgba(15, 43, 77, 0.8), rgba(10, 26, 51, 0.9)), url(' + heroImageUrl + ')'">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Rebuild Tamil Nadu Schools</h1>
            <p class="tagline">Choose a school. Make an impact. Transform a future.</p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="(raisedAmount / fundingGoal) * 100"></div>
                </div>
                <div class="progress-stats">
                    <span>₹{{raisedAmount | number}} raised of ₹{{fundingGoal | number}} goal</span>
                    <span>{{((raisedAmount / fundingGoal) * 100).toFixed(0)}}% funded</span>
                </div>
            </div>
        </div>
    </div>

    <div class="schools-section" *ngIf="!selectedSchool">
        <h2 class="section-title">Featured Government Schools in Need</h2>
        <p class="section-subtitle">You are about to make a difference in the lives of students at a Tamil Nadu
            Government School. Your support will help renovate their classrooms, provide better learning tools, and
            build a brighter tomorrow.</p>

    <div class="school-list">
        <div class="school-card" *ngFor="let school of schools" (mouseenter)="onSchoolHover(school, true)"
            (mouseleave)="onSchoolHover(school, false)">
    
            <div class="school-image">
            <div class="image-slider-overlay" *ngIf="school.conditionPhotos && school.conditionPhotos.length > 0"
                (click)="openImageModal(school, school.currentPhotoIndex!, $event)">
            
                <img [src]="school.conditionPhotos[school.currentPhotoIndex!]" alt="Condition Photo">
                <button class="slider-btn prev" (click)="previousPhoto(school, $event)">&lt;</button>
                <button class="slider-btn next" (click)="nextPhoto(school, $event)">&gt;</button>
            </div>
    
                <div class="no-photo-fallback" *ngIf="!school.conditionPhotos || school.conditionPhotos.length === 0">
                    <span>No Photos Available</span>
                </div>
            </div>
    
            <div class="school-info">
                <h3>{{school.schoolNameEn}}</h3>
                <p class="school-location">{{school.district}}, {{school.block}}</p>
                <div class="renovation-areas">
                    <span class="renovation-tag" *ngFor="let area of school.renovationAreas">{{area}}</span>
                </div>
                <div class="card-buttons">
                    <button class="support-btn" (click)="selectSchool(school)">Support This School</button>
                    <button class="map-btn" (click)="viewOnMap(school)">View on Map</button>
                </div>
            </div>
        </div>
    </div>
    </div>


    <div class="modal" [class.show]="selectedSchool" >
        <div class="modal-content">
            <span class="close-btn" (click)="closeModal()">×</span>
            <div class="donation-form-section">
                <form [formGroup]="donationForm" (ngSubmit)="onSubmit()">
                    <div class="form-header">
                        <h2>Support {{selectedSchool?.schoolNameEn}}</h2>
                        <p>You are about to make a difference in the lives of students at
                            {{selectedSchool?.schoolNameEn}}. Your
                            support will help renovate their classrooms, provide better learning tools, and build a
                            brighter tomorrow.</p>
                    </div>

                    <div class="form-steps-indicator">
                        <div class="step" [class.active]="currentStep === 1">
                            <div class="step-circle">1</div>
                            <div class="step-label">Personal Info</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" [class.active]="currentStep === 2">
                            <div class="step-circle">2</div>
                            <div class="step-label">Donation Amount</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" [class.active]="currentStep === 3">
                            <div class="step-circle">3</div>
                            <div class="step-label">Payment</div>
                        </div>
                    </div>

                    <div class="step-content" *ngIf="currentStep === 1" > 
                        <div class="form-group" [class.focused]="donationForm.get('name')?.value"
                            [class.has-value]="donationForm.get('name')?.value">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" formControlName="name" placeholder="Enter your full name"
                                required>
                            <div *ngIf="donationForm.get('name')?.invalid && donationForm.get('name')?.touched"
                                class="error-message">
                                Name is required.
                            </div>
                        </div>
                        <div class="form-group" [class.focused]="donationForm.get('email')?.value"
                            [class.has-value]="donationForm.get('email')?.value">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" formControlName="email" placeholder="Enter your email"
                                required>
                            <div *ngIf="donationForm.get('email')?.invalid && donationForm.get('email')?.touched"
                                class="error-message">
                                <span *ngIf="donationForm.get('email')?.errors?.['required']">Email is required.</span>
                                <span *ngIf="donationForm.get('email')?.errors?.['email']">Please enter a valid email
                                    address.</span>
                            </div>
                        </div>
                        <div class="form-group" [class.focused]="donationForm.get('phone')?.value"
                            [class.has-value]="donationForm.get('phone')?.value">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" formControlName="phone" placeholder="Enter your phone number">
                            <div *ngIf="donationForm.get('phone')?.invalid && donationForm.get('phone')?.touched"
                                class="error-message">
                                Please enter a valid 10-digit phone number.
                            </div>
                        </div>
                    </div>

                    <div class="step-content" *ngIf="currentStep === 2" >
                        <div class="form-group">
                            <label>Donation Amount (₹)</label>
                            <div class="quick-amounts">
                                <button type="button" *ngFor="let option of quickAmounts"
                                    [class.selected]="donationForm.value.amount === option"
                                    (click)="selectAmount(option)">
                                    ₹{{option | number}}
                                </button>
                            </div>
                            <div class="custom-amount">
                                <span class="currency-symbol">₹</span>
                                <input type="number" id="amount" formControlName="amount"
                                    placeholder="Enter custom amount" min="100" step="100" required>
                            </div>
                            <div *ngIf="donationForm.get('amount')?.invalid && donationForm.get('amount')?.touched"
                                class="error-message">
                                <span *ngIf="donationForm.get('amount')?.errors?.['required']">Donation amount is
                                    required.</span>
                                <span *ngIf="donationForm.get('amount')?.errors?.['min']">Amount must be at least
                                    ₹100.</span>
                            </div>
                        </div>
                        <div class="form-group" [class.focused]="donationForm.get('dedication')?.value">
                            <label>Dedication (Optional)</label>
                            <textarea formControlName="dedication"
                                placeholder="In honor/memory of someone special?"></textarea>
                        </div>
                    </div>

                    <div class="step-content" *ngIf="currentStep === 3" >
                        <div class="form-group">
                            <label>Choose a Payment Method</label>
                            <div class="payment-methods-grid">
                                <div class="payment-method-card" *ngFor="let method of paymentMethods"
                                    [class.selected]="selectedPayment === method.id"
                                    (click)="selectPaymentMethod(method.id)">
                                    <div class="method-icon"><i class="{{ method.icon }}"></i></div>
                                    <div class="method-info">
                                        <h4>{{method.name}}</h4>
                                        <p>{{method.description}}</p>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="donationForm.get('paymentMethod')?.invalid && donationForm.get('paymentMethod')?.touched"
                                class="error-message">
                                Please select a payment method.
                            </div>
                        </div>

                        <!-- Payment Details Section -->
                        <div class="payment-details-wrapper">
                            <!-- Credit Card Fields -->
                            <div class="payment-details" *ngIf="selectedPayment === 'credit_card'" [@detailsFade]>
                                <div class="form-group" [class.focused]="donationForm.get('cardNumber')?.value">
                                    <label for="cardNumber">Card Number</label>
                                    <input type="text" id="cardNumber" formControlName="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456">
                                    <div *ngIf="donationForm.get('cardNumber')?.invalid && donationForm.get('cardNumber')?.touched" class="error-message">
                                        Please enter a valid card number.
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group third-width" [class.focused]="donationForm.get('expiry')?.value">
                                        <label for="expiry">Expiry Date</label>
                                        <input type="text" id="expiry" formControlName="expiry" maxlength="5" placeholder="MM/YY">
                                        <div *ngIf="donationForm.get('expiry')?.invalid && donationForm.get('expiry')?.touched" class="error-message">
                                            Invalid expiry date.
                                        </div>
                                    </div>
                                    <div class="form-group third-width" [class.focused]="donationForm.get('cvv')?.value">
                                        <label for="cvv">CVV</label>
                                        <input type="password" id="cvv" formControlName="cvv" maxlength="4" placeholder="CVV">
                                        <div *ngIf="donationForm.get('cvv')?.invalid && donationForm.get('cvv')?.touched" class="error-message">
                                            Invalid CVV.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Net Banking Fields -->
                            <div class="payment-details" *ngIf="selectedPayment === 'netbanking'" >
                                <div class="form-group" [class.focused]="donationForm.get('bankName')?.value">
                                    <label for="bankName">Bank Name</label>
                                    <select id="bankName" formControlName="bankName">
                                        <option value="">Select Bank</option>
                                        <option *ngFor="let bank of bankNames" [value]="bank">{{bank}}</option>
                                    </select>
                                    <div *ngIf="donationForm.get('bankName')?.invalid && donationForm.get('bankName')?.touched" class="error-message">
                                        Please select a bank.
                                    </div>
                                </div>
                                <div class="form-group" [class.focused]="donationForm.get('accountNumber')?.value">
                                    <label for="accountNumber">Account Number</label>
                                    <input type="text" id="accountNumber" formControlName="accountNumber" maxlength="18" placeholder="Account Number">
                                    <div *ngIf="donationForm.get('accountNumber')?.invalid && donationForm.get('accountNumber')?.touched" class="error-message">
                                        Please enter a valid account number.
                                    </div>
                                </div>
                                <div class="form-group" [class.focused]="donationForm.get('ifsc')?.value">
                                    <label for="ifsc">IFSC Code</label>
                                    <input type="text" id="ifsc" formControlName="ifsc" maxlength="11" placeholder="IFSC Code">
                                    <div *ngIf="donationForm.get('ifsc')?.invalid && donationForm.get('ifsc')?.touched" class="error-message">
                                        Please enter a valid IFSC code.
                                    </div>
                                </div>
                            </div>
                            <!-- UPI Fields -->
                            <div class="payment-details" *ngIf="selectedPayment === 'upi'" [@detailsFade]>
                                <div class="form-group" [class.focused]="donationForm.get('upiId')?.value">
                                    <label for="upiId">UPI ID</label>
                                    <input type="text" id="upiId" formControlName="upiId" placeholder="yourname@bank">
                                    <div *ngIf="donationForm.get('upiId')?.invalid && donationForm.get('upiId')?.touched" class="error-message">
                                        Please enter a valid UPI ID.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" formControlName="coverFees">
                                Add ₹{{feeAmount | number}} to cover payment processing fees
                            </label>
                        </div>
                    </div>

                    <div class="form-navigation">
                        <button type="button" class="btn-secondary" *ngIf="currentStep > 1" (click)="prevStep()">
                            Back
                        </button>
                        <button type="button" class="btn-primary" *ngIf="currentStep < 3" (click)="nextStep()"
                            [disabled]="!isCurrentStepValid()">
                            Continue
                        </button>
                        <button type="submit" class="btn-primary" *ngIf="currentStep === 3"
                            [disabled]="!donationForm.valid || isProcessing">
                            <span *ngIf="!isProcessing">Proceed to Pay</span>
                            <span *ngIf="isProcessing">
                                <i class="fas fa-spinner fa-spin"></i> Processing...
                            </span>
                        </button>
                        <button type="button" class="btn-close-form" (click)="closeModal()">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <p class="bottom-info">All donations directly support infrastructure and learning resources for the selected school.
    </p>

    <div class="impact-gallery">
        <h2 class="section-title">See Your Impact</h2>
        <div class="gallery-grid">
            <div class="gallery-item" *ngFor="let image of impactImages">
                <img [src]="image.src" [alt]="image.alt">
                <div class="image-caption">{{image.caption}}</div>
            </div>
        </div>
    </div>

    <div class="testimonial-section">
        <h2 class="section-title">Donor Stories</h2>
        <div class="testimonial-carousel">
            <div class="testimonial-item" *ngFor="let testimonial of testimonials">
                <div class="testimonial-content">
                    <blockquote>{{testimonial.quote}}</blockquote>
                    <div class="testimonial-author">
                        <div class="author-name">{{testimonial.name}}</div>
                        <div class="author-title">{{testimonial.title}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="image-modal-overlay" *ngIf="showImageModal" (click)="closeImageModal()">
        <div class="image-modal-content" (click)="$event.stopPropagation()">
            <span class="image-modal-close" (click)="closeImageModal()">&times;</span>
    
            <img [src]="modalPhotos[currentModalPhotoIndex]" alt="Full size school photo">
    
            <button class="image-modal-nav prev" *ngIf="modalPhotos.length > 1"
                (click)="previousModalPhoto($event)">&#10094;</button>
            <button class="image-modal-nav next" *ngIf="modalPhotos.length > 1"
                (click)="nextModalPhoto($event)">&#10095;</button>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-wrapper">
                        <img src="assets/images/govt_logo.jpeg" alt="Government of Tamil Nadu Logo" class="govt-logo">
                    </div>
                    <div class="footer-logo-text">
                        <h3>{{ currentLanguage === 'english' ? 'Tamil Nadu School Renovation Initiative' : 'தமிழ்நாடு
                            பள்ளி புதுப்பித்தல் முயற்சி' }}</h3>
                        <p>{{ currentLanguage === 'english' ? 'Building better futures through education' : 'கல்வி மூலம்
                            சிறந்த எதிர்காலத்தை உருவாக்குதல்' }}</p>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>{{ currentLanguage === 'english' ? 'Quick Links' : 'விரைவு இணைப்புகள்' }}</h4>
                    <ul>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Home' : 'முகப்பு' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Schools' : 'பள்ளிகள்' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Donate' : 'நன்கொடை' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Volunteer' : 'தன்னார்வலர்' }}</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>{{ currentLanguage === 'english' ? 'Contact Us' : 'எங்களைத் தொடர்பு கொள்ள' }}</h4>
                    <p>infotnschools.in</p>
                    <p>+91 9876543210</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; {{ currentYear }} {{ currentLanguage === 'english' ? 'Tamil Nadu School Renovation Initiative.
                    All rights reserved.' : 'தமிழ்நாடு பள்ளி புதுப்பித்தல் முயற்சி. அனைத்து உரிமைகளும்
                    பாதுகாக்கப்பட்டவை.' }}</p>
            </div>
        </div>
    </footer>
</div>