<div class="full-width-container dark-theme">
    <div class="donation-hero"
        [style.background-image]="'linear-gradient(rgba(15, 43, 77, 0.8), rgba(10, 26, 51, 0.9)), url(' + heroImageUrl + ')'">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Rebuild Tamil Nadu Schools</h1>
            <p class="tagline">Choose a school. Make an impact. Transform a future.</p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="(raisedAmount / fundingGoal) * 100"></div>
                </div>
                <div class="progress-stats">
                    <span>₹{{raisedAmount | number}} raised of ₹{{fundingGoal | number}} goal</span>
                    <span>{{((raisedAmount / fundingGoal) * 100).toFixed(0)}}% funded</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Featured Schools Section -->
    <div class="schools-section" *ngIf="!selectedSchool">
        <h2 class="section-title">Featured Government Schools in Need</h2>
        <p class="section-subtitle">You are about to make a difference in the lives of students at a Tamil Nadu
            Government School. Your support will help renovate their classrooms, provide better learning tools, and
            build a brighter tomorrow.</p>

        <div class="school-list">
            <div class="school-card" *ngFor="let school of schools">
                <div class="school-image"
                    [style.background-image]="'url(' + (school.image || 'https://placehold.co/600x400/0f2b4d/ffffff') + ')'">
                </div>
                <div class="school-info">
                    <h3>{{school.schoolNameEn}}</h3>
                    <p class="school-location">{{school.district}}, {{school.block}}</p>
                    <div class="renovation-areas">
                        <span class="renovation-tag" *ngFor="let area of school.renovationAreas">{{area}}</span>
                    </div>
                    <div class="card-buttons">
                        <button class="support-btn" (click)="selectSchool(school)">Support This School</button>
                        <button class="map-btn" (click)="viewOnMap(school)">View on Map</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Donation Form -->
<div class="modal" [class.show]="selectedSchool">
    <div class="modal-content">
        <span class="close-btn" (click)="closeModal()">&times;</span>
        <div class="donation-form-section">
            <form [formGroup]="donationForm" (ngSubmit)="onSubmit()">
                <div class="form-header">
                    <h2>Support {{selectedSchool?.schoolNameEn}}</h2>
                    <p>You are about to make a difference in the lives of students at
                        {{selectedSchool?.schoolNameEn}}. Your
                        support will help renovate their classrooms, provide better learning tools, and build a
                        brighter tomorrow.</p>
                </div>

                <div class="form-steps-indicator">
                    <div class="step" [class.active]="currentStep === 1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Personal Info</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" [class.active]="currentStep === 2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Donation Amount</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" [class.active]="currentStep === 3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Payment</div>
                    </div>
                </div>

                <div class="step-content" *ngIf="currentStep === 1">
                    <div class="form-group" [class.focused]="donationForm.get('name')?.value"
                        [class.has-value]="donationForm.get('name')?.value">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" formControlName="name" placeholder="Enter your full name" required
                            (focus)="donationForm.get('name')?.markAsTouched()"
                            (blur)="donationForm.get('name')?.markAsTouched()">
                        <div *ngIf="donationForm.get('name')?.invalid && donationForm.get('name')?.touched"
                            class="error-message">
                            Name is required.
                        </div>
                    </div>
                    <div class="form-group" [class.focused]="donationForm.get('email')?.value"
                        [class.has-value]="donationForm.get('email')?.value">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" formControlName="email" placeholder="Enter your email" required
                            (focus)="donationForm.get('email')?.markAsTouched()"
                            (blur)="donationForm.get('email')?.markAsTouched()">
                        <div *ngIf="donationForm.get('email')?.invalid && donationForm.get('email')?.touched"
                            class="error-message">
                            <span *ngIf="donationForm.get('email')?.errors?.['required']">Email is required.</span>
                            <span *ngIf="donationForm.get('email')?.errors?.['email']">Please enter a valid email
                                address.</span>
                        </div>
                    </div>
                    <div class="form-group" [class.focused]="donationForm.get('phone')?.value"
                        [class.has-value]="donationForm.get('phone')?.value">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" formControlName="phone" placeholder="Enter your phone number"
                            (focus)="donationForm.get('phone')?.markAsTouched()"
                            (blur)="donationForm.get('phone')?.markAsTouched()">
                        <div *ngIf="donationForm.get('phone')?.invalid && donationForm.get('phone')?.touched"
                            class="error-message">
                            Please enter a valid 10-digit phone number.
                        </div>
                    </div>
                </div>

                <div class="step-content" *ngIf="currentStep === 2">
                    <div class="form-group">
                        <label>Donation Amount (₹)</label>
                        <div class="quick-amounts">
                            <button type="button" *ngFor="let option of quickAmounts"
                                [class.selected]="donationForm.value.amount === option" (click)="selectAmount(option)">
                                ₹{{option | number}}
                            </button>
                        </div>
                        <div class="custom-amount">
                            <span class="currency-symbol">₹</span>
                            <input type="number" id="amount" formControlName="amount" placeholder="Enter custom amount"
                                min="100" step="100" required (focus)="donationForm.get('amount')?.markAsTouched()"
                                (blur)="donationForm.get('amount')?.markAsTouched()">
                        </div>
                        <div *ngIf="donationForm.get('amount')?.invalid && donationForm.get('amount')?.touched"
                            class="error-message">
                            <span *ngIf="donationForm.get('amount')?.errors?.['required']">Donation amount is
                                required.</span>
                            <span *ngIf="donationForm.get('amount')?.errors?.['min']">Amount must be at least
                                ₹100.</span>
                        </div>
                    </div>

                    <div class="form-group" [class.focused]="donationForm.get('dedication')?.value">
                        <label>Dedication (Optional)</label>
                        <textarea formControlName="dedication" placeholder="In honor/memory of someone special?"
                            (focus)="donationForm.get('dedication')?.markAsTouched()"
                            (blur)="donationForm.get('dedication')?.markAsTouched()"></textarea>
                    </div>
                </div>

                <div class="step-content" *ngIf="currentStep === 3">
                    <div class="form-group">
                        <label>Choose a Payment Method</label>
                        <div class="payment-methods-grid">
                            <div class="payment-method-card" *ngFor="let method of paymentMethods"
                                [class.selected]="selectedPayment === method.id"
                                (click)="selectPaymentMethod(method.id)">
                                <div class="method-icon"><i class="{{ method.icon }}"></i></div>
                                <div class="method-info">
                                    <h4>{{method.name}}</h4>
                                    <p>{{method.description}}</p>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="donationForm.get('paymentMethod')?.invalid && donationForm.get('paymentMethod')?.touched"
                            class="error-message">
                            Please select a payment method.
                        </div>
                    </div>

                    <div class="card-payment-details" *ngIf="selectedPayment === 'credit_card'">
                        <div class="form-row">
                            <div class="form-group half-width" [class.focused]="donationForm.get('cardNumber')?.value"
                                [class.has-value]="donationForm.get('cardNumber')?.value">
                                <label for="cardNumber">Card Number</label>
                                <input type="text" id="cardNumber" formControlName="cardNumber"
                                    placeholder="1234 5678 9012 3456" maxlength="19"
                                    (focus)="donationForm.get('cardNumber')?.markAsTouched()"
                                    (blur)="donationForm.get('cardNumber')?.markAsTouched()">
                                <div *ngIf="donationForm.get('cardNumber')?.invalid && donationForm.get('cardNumber')?.touched"
                                    class="error-message">
                                    Card number is required.
                                </div>
                            </div>
                            <div class="form-group half-width" [class.focused]="donationForm.get('cardName')?.value"
                                [class.has-value]="donationForm.get('cardName')?.value">
                                <label for="cardName">Name on Card</label>
                                <input type="text" id="cardName" formControlName="cardName"
                                    placeholder="Name as shown on card"
                                    (focus)="donationForm.get('cardName')?.markAsTouched()"
                                    (blur)="donationForm.get('cardName')?.markAsTouched()">
                                <div *ngIf="donationForm.get('cardName')?.invalid && donationForm.get('cardName')?.touched"
                                    class="error-message">
                                    Name on card is required.
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group third-width" [class.focused]="donationForm.get('expiry')?.value"
                                [class.has-value]="donationForm.get('expiry')?.value">
                                <label for="expiry">Expiry</label>
                                <input type="text" id="expiry" formControlName="expiry" placeholder="MM/YY"
                                    maxlength="5" (focus)="donationForm.get('expiry')?.markAsTouched()"
                                    (blur)="donationForm.get('expiry')?.markAsTouched()">
                                <div *ngIf="donationForm.get('expiry')?.invalid && donationForm.get('expiry')?.touched"
                                    class="error-message">
                                    Expiry is required (MM/YY format).
                                </div>
                            </div>
                            <div class="form-group third-width" [class.focused]="donationForm.get('cvv')?.value"
                                [class.has-value]="donationForm.get('cvv')?.value">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" formControlName="cvv" placeholder="123" maxlength="3"
                                    (focus)="donationForm.get('cvv')?.markAsTouched()"
                                    (blur)="donationForm.get('cvv')?.markAsTouched()">
                                <div *ngIf="donationForm.get('cvv')?.invalid && donationForm.get('cvv')?.touched"
                                    class="error-message">
                                    CVV is required (3-4 digits).
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" formControlName="coverFees">
                            Add ₹{{feeAmount | number}} to cover payment processing fees
                        </label>
                    </div>
                </div>

                <!-- Form Navigation and Loading State -->
                <div class="form-navigation">
                    <button type="button" class="btn-secondary" *ngIf="currentStep > 1" (click)="prevStep()">
                        Back
                    </button>
                    <button type="button" class="btn-primary" *ngIf="currentStep < 3" (click)="nextStep()"
                        [disabled]="!isCurrentStepValid()">
                        Continue
                    </button>
                    <button type="submit" class="btn-primary" *ngIf="currentStep === 3"
                        [disabled]="!donationForm.valid || isProcessing">
                        <span *ngIf="!isProcessing">Complete Donation</span>
                        <span *ngIf="isProcessing">
                            <i class="fas fa-spinner fa-spin"></i> Processing...
                        </span>
                    </button>
                </div>
            </form>
            <p class="bottom-info">All donations directly support infrastructure and learning resources for the
                selected school.</p>
        </div>
    </div>
</div>
                <p class="bottom-info">All donations directly support infrastructure and learning resources for the
                    selected
                    school.</p>
            </div>
        



    <div class="impact-gallery">
        <h2 class="section-title">See Your Impact</h2>
        <div class="gallery-grid">
            <div class="gallery-item" *ngFor="let image of impactImages">
                <img [src]="image.src" [alt]="image.alt">
                <div class="image-caption">{{image.caption}}</div>
            </div>
        </div>
    </div>

    <div class="testimonial-section">
        <h2 class="section-title">Donor Stories</h2>
        <div class="testimonial-carousel">
            <div class="testimonial-item" *ngFor="let testimonial of testimonials">
                <div class="testimonial-content">
                    <blockquote>{{testimonial.quote}}</blockquote>
                    <div class="testimonial-author">
                        <div class="author-name">{{testimonial.name}}</div>
                        <div class="author-title">{{testimonial.title}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-wrapper">
                        <img src="assets/images/govt_logo.jpeg" alt="Government of Tamil Nadu Logo" class="govt-logo">
                    </div>
                    <div class="footer-logo-text">
                        <h3>{{ currentLanguage === 'english' ? 'Tamil Nadu School Renovation Initiative' : 'தமிழ்நாடு
                            பள்ளி புதுப்பித்தல் முயற்சி' }}</h3>
                        <p>{{ currentLanguage === 'english' ? 'Building better futures through education' : 'கல்வி மூலம்
                            சிறந்த எதிர்காலத்தை உருவாக்குதல்' }}</p>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>{{ currentLanguage === 'english' ? 'Quick Links' : 'விரைவு இணைப்புகள்' }}</h4>
                    <ul>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Home' : 'முகப்பு' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Schools' : 'பள்ளிகள்' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Donate' : 'நன்கொடை' }}</a></li>
                        <li><a href="#">{{ currentLanguage === 'english' ? 'Volunteer' : 'தன்னார்வலர்' }}</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>{{ currentLanguage === 'english' ? 'Contact Us' : 'எங்களைத் தொடர்பு கொள்ள' }}</h4>
                    <p>infotnschools.in</p>
                    <p>+91 9876543210</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; {{ currentYear }} {{ currentLanguage === 'english' ? 'Tamil Nadu School Renovation Initiative.
                    All rights reserved.' : 'தமிழ்நாடு பள்ளி புதுப்பித்தல் முயற்சி. அனைத்து உரிமைகளும்
                    பாதுகாக்கப்பட்டவை.' }}</p>
            </div>
        </div>
    </footer>
